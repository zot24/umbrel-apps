version: "3.7"

services:
  app_proxy:
    environment:
      APP_HOST: zot24-openclaw_web_1
      APP_PORT: 18789

  web:
    image: ghcr.io/zot24/openclaw-docker:v2026.2.6
    # Note: No user directive - container starts as root, entrypoint fixes
    # volume permissions then drops to openclaw user (UID 1000)
    restart: on-failure
    stop_grace_period: 1m
    volumes:
      - ${APP_DATA_DIR}/data:/home/openclaw/.openclaw
      - ${APP_DATA_DIR}/workspace:/home/openclaw/clawd
    environment:
      # Ensure HOME is set correctly (Umbrel may override)
      HOME: /home/openclaw
      # Anthropic API Key for Claude models
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY:-}
      # OpenAI API Key (optional, for embeddings/memory search)
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      # Telegram Bot Token (get from @BotFather on Telegram)
      TELEGRAM_BOT_TOKEN: ${TELEGRAM_BOT_TOKEN:-}
      # Gateway configuration (WebChat UI served at /chat on gateway port)
      OPENCLAW_GATEWAY_PORT: 18789
      # Data directories
      OPENCLAW_DATA_DIR: /home/openclaw/.openclaw
      OPENCLAW_WORKSPACE: /home/openclaw/clawd
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:18789/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
