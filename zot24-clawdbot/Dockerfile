# Clawdbot Umbrel App Dockerfile
# Builds Clawdbot from source with all dependencies

FROM node:22-bookworm

# Install system dependencies
RUN apt-get update && apt-get install -y \
    git \
    curl \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*

# Install pnpm
RUN corepack enable && corepack prepare pnpm@latest --activate

# Set working directory
WORKDIR /app

# Clone Clawdbot repository
RUN git clone --depth 1 https://github.com/clawdbot/clawdbot.git .

# Install dependencies
RUN pnpm install --frozen-lockfile

# Build the application
RUN pnpm build

# Create data directories
RUN mkdir -p /root/.clawdbot /root/clawd

# Copy entrypoint script
COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

# Expose ports
# 18789: Gateway WebSocket API
# 18790: WebChat UI
EXPOSE 18789 18790

# Set environment
ENV NODE_ENV=production

ENTRYPOINT ["/entrypoint.sh"]
CMD ["gateway"]
